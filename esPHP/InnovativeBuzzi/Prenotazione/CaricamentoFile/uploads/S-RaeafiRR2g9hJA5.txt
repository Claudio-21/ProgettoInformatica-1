create database provacompito;
-------------------------
create table biscotto(
	codice varchar(32) primary key,
	nome varchar(32),
	forma varchar(32),
	nomeCreatore varchar(32),
	dittaProduttrice varchar(32)
);
create table ingrediente(
	codice varchar(32) primary key,
	nome varchar(32),
	tipologia varchar(32)
);
create table composizione(
	codice_biscotto varchar(32),
	codice_ingrediente varchar(32),
	quantitá decimal(9,2),
	foreign key(codice_biscotto) references biscotto(codice),
	foreign key(codice_ingrediente) references ingrediente(codice),
	primary key(codice_biscotto,codice_ingrediente)
);
---------------------------
inserimenti
insert into biscotto(codice,nome,forma,nomeCreatore,dittaProduttrice)
	values("123","prova1","Circolare","tester1","Port"),
    	("234","prova2","Circolare","tester2","Port"),
        ("456","prova3","Circolare","tester3","Port3");
    	
insert into ingrediente(codice,nome,tipologia)
	values("A10","Cioccolato","Naturali"),
    ("A20","liy2","Artificiali"),
    ("A30","liy3","Naturali");

insert into composizione(codice_biscotto,codice_ingrediente,quantitá)
	values("123","A10",23.4),
    		("456","A10",3.4),
        	("234","A30",45.9);
1)
select biscotto.nome
from ingrediente join composizione on ingrediente.codice=composizione.codice_ingrediente join biscotto on composizione.codice_biscotto=biscotto.codice
where composizione.quantitá=3.4 and ingrediente.codice="A20"
2)select biscotto.nome
from biscotto join composizione on biscotto.codice=composizione.codice_biscotto join ingrediente on composizione.codice_ingrediente=ingrediente.codice
where biscotto.forma="Circolare" and biscotto.dittaProduttrice="Port" and ingrediente.nome="Cioccolato" and composizione.quantitá=23.4
3)select distinct biscotto.codice
from biscotto join composizione on biscotto.codice=composizione.codice_biscotto join ingrediente on composizione.codice_ingrediente=ingrediente.codice
where ingrediente.tipologia="Farina di riso" and composizione.quantitá=0.3 and biscotto.codice In ( select biscotto.codice
                            from biscotto join composizione on biscotto.codice=composizione.codice_biscotto join ingrediente on 										composizione.codice_ingrediente=ingrediente.codice
                            where ingrediente.tipologia="zucchero" and composizione.quantitá=0.3)
4)select distinct biscotto.codice
from biscotto join composizione on biscotto.codice=composizione.codice_biscotto join ingrediente on composizione.codice_ingrediente=ingrediente.codice
where ingrediente.tipologia="Naturale" and biscotto.forma="Triangolare"
5)create view ARTIFICIALE as
select biscotto.codice,COUNT(ingrediente.codice) as numero_biscotti_artificiali
from biscotto join composizione on biscotto.codice=composizione.codice_biscotto join ingrediente on composizione.codice_ingrediente=ingrediente.codice
where ingrediente.tipologia="Artificiale"
group by 
	biscotto.codice
---- 
create view NATURALE as
select biscotto.codice,COUNT(ingrediente.codice) as numero_biscotti_naturali
from biscotto join composizione on biscotto.codice=composizione.codice_biscotto join ingrediente on composizione.codice_ingrediente=ingrediente.codice
where ingrediente.tipologia="naturale"
group by 
	biscotto.codice
6)select artificiale.codice,biscotto.nome
from biscotto join artificiale on biscotto.codice=artificiale.codice join naturale on artificiale.codice=naturale.codice
where artificiale.numero_biscotti_artificiali > naturale.numero_biscotti_naturali
7)create view totale_ingredienti as 
select biscotto.codice,COUNT(composizione.codice_ingrediente) as nm_ingredienti_totale
from biscotto join composizione on biscotto.codice=composizione.codice_biscotto 
group by  biscotto.codice

SELECT totale_ingredienti.codice,MIN(totale_ingredienti.nm_ingredienti_totale) as min_ingredienti
from totale_ingredienti
8)select biscotto.nomeCreatore,SUM(composizione.quantitá) as sum1
from biscotto join composizione on biscotto.codice=composizione.codice_biscotto join ingrediente on composizione.codice_ingrediente=ingrediente.codice
where biscotto.forma="Esagonale" and ingrediente.tipologia="Naturale"
GROUP by 
	biscotto.codice
having sum1>70
9)select biscotto.nome,MAX(composizione.quantitá) as max_quant, MIN(composizione.quantitá) as min_quant
from biscotto join composizione on biscotto.codice=composizione.codice_biscotto join ingrediente on composizione.codice_ingrediente=ingrediente.codice
GROUP BY	biscotto.nome
10)SELECT biscotto.nome,biscotto.dittaProduttrice,MAX(composizione.codice_ingrediente) as max
from biscotto join composizione on biscotto.codice=composizione.codice_biscotto join ingrediente on composizione.codice_ingrediente=ingrediente.codice
where ingrediente.nome="Cacao"  
GROUP by 
	biscotto.nome,biscotto.dittaProduttrice


11)alter table ingrediente 
add column calorie decimal(9,2)
12)
create view CALORIE as 
select biscotto.codice,SUM(ingrediente.calorie*100) as somma_calorie
from biscotto join composizione on biscotto.codice=composizione.codice_biscotto join ingrediente on composizione.codice_ingrediente=ingrediente.codice
group by 
	biscotto.codice
13)SELECT biscotto.nome,MIN(calorie.somma_calorie)
from calorie join biscotto on calorie.codice=biscotto.codice


        